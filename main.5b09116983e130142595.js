(()=>{"use strict";class t{constructor(t=4){this.size=t,this.totalCells=t*t,this.element=document.getElementById("gameBoard"),this.lastGoblinPosition=null}render(){this.element.innerHTML="";for(let t=0;t<this.totalCells;t++){const e=document.createElement("div");e.className="cell",e.dataset.index=t;const i=document.createElement("div");i.className="hole";const s=document.createElement("div");s.className="hole-inner",i.append(s),e.append(i),this.element.append(e)}}getRandomPosition(){const t=Array.from({length:this.totalCells},(t,e)=>e),e=null!==this.lastGoblinPosition?t.filter(t=>t!==this.lastGoblinPosition):t,i=e[Math.floor(Math.random()*e.length)];return this.lastGoblinPosition=i,i}resetPositionHistory(){this.lastGoblinPosition=null}}class e{constructor(t){this.image=new Image,this.image.src=t,this.image.className="dwarf goblin",this.image.alt="Ð“Ð¾Ð±Ð»Ð¸Ð½",this.currentPosition=null,this.isVisible=!1,this.isBeingHidden=!1,this.lastPosition=null}show(t){if(this.isVisible||this.isBeingHidden)return;this.currentPosition=t,this.isVisible=!0,this.isBeingHidden=!1,this.lastPosition=t;const e=document.querySelector(`.cell[data-index="${t}"] .hole-inner`);e&&(e.append(this.image),this.image.style.opacity="1",this.image.style.transform="scale(1)")}hide(){this.isVisible&&!this.isBeingHidden&&(this.isBeingHidden=!0,this.isVisible=!1,this.image.remove(),this.currentPosition=null,this.isBeingHidden=!1)}hideImmediately(){this.image.remove(),this.isVisible=!1,this.isBeingHidden=!1,this.currentPosition=null}checkHit(t){return this.isVisible&&!this.isBeingHidden&&t===this.currentPosition}hit(){this.image.classList.add("hit-animation"),setTimeout(()=>{this.image.classList.remove("hit-animation")},300)}getCurrentPosition(){return this.currentPosition}canAppearInPosition(t){return t!==this.lastPosition}resetPositionHistory(){this.lastPosition=null}}class i{constructor(t){this.initialTime=t,this.timeLeft=t,this.element=document.getElementById("time"),this.timerInterval=null,this.isRunning=!1}start(t){this.isRunning||(this.isRunning=!0,this.timerInterval=setInterval(()=>{this.timeLeft--,this.updateDisplay(),this.timeLeft<=0&&(this.pause(),t&&t())},1e3))}pause(){this.isRunning&&(this.isRunning=!1,clearInterval(this.timerInterval),this.timerInterval=null)}reset(){this.pause(),this.timeLeft=this.initialTime,this.updateDisplay()}updateDisplay(){this.element&&(this.element.textContent=this.timeLeft)}}class s{constructor(){this.score=0,this.element=document.getElementById("score")}increase(){this.score++,this.animate()}reset(){this.score=0,this.updateDisplay()}getScore(){return this.score}updateDisplay(){this.element&&(this.element.textContent=this.score)}animate(){this.element.classList.add("score-animation"),setTimeout(()=>{this.element.classList.remove("score-animation")},300),this.updateDisplay()}}class n{constructor(){this.cursor=document.createElement("div"),this.cursor.className="hammer-cursor",this.cursor.innerHTML="ðŸ”¨",this.isAttached=!1}attach(){if(this.isAttached)return;document.body.append(this.cursor),document.addEventListener("mousemove",this.updatePosition.bind(this));const t=document.getElementById("gameBoard");t.addEventListener("mouseenter",()=>{this.show()}),t.addEventListener("mouseleave",()=>{this.hide()}),t.addEventListener("mousedown",()=>{this.hit()}),t.addEventListener("mouseup",()=>{this.reset()}),this.isAttached=!0}updatePosition(t){this.cursor.style.left=`${t.clientX}px`,this.cursor.style.top=`${t.clientY}px`}show(){this.cursor.style.display="block"}hide(){this.cursor.style.display="none",document.body.style.cursor="default"}hit(){this.cursor.classList.add("hammer-hit"),this.cursor.innerHTML="ðŸ’¥"}reset(){this.cursor.classList.remove("hammer-hit"),this.cursor.innerHTML="ðŸ”¨"}}class o{constructor(){this.overlay=null,this.notification=null,this.title=null,this.message=null,this.button=null,this.createNotificationUI()}createNotificationUI(){this.overlay=document.createElement("div"),this.overlay.id="gameOverlay",this.overlay.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.7);\n      display: none;\n      justify-content: center;\n      align-items: center;\n      z-index: 1000;\n    ",this.notification=document.createElement("div"),this.notification.id="gameNotification",this.notification.style.cssText="\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 30px;\n      border-radius: 15px;\n      text-align: center;\n      max-width: 400px;\n      width: 90%;\n      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);\n      animation: slideIn 0.3s ease-out;\n    ",this.title=document.createElement("h2"),this.title.id="notificationTitle",this.title.style.cssText="\n      margin: 0 0 20px 0;\n      font-size: 28px;\n      font-weight: bold;\n    ",this.message=document.createElement("div"),this.message.id="notificationMessage",this.message.style.cssText="\n      font-size: 18px;\n      margin-bottom: 25px;\n      line-height: 1.5;\n    ",this.button=document.createElement("button"),this.button.id="notificationButton",this.button.style.cssText="\n      background: white;\n      color: #667eea;\n      border: none;\n      padding: 12px 30px;\n      font-size: 18px;\n      border-radius: 25px;\n      cursor: pointer;\n      font-weight: bold;\n      transition: transform 0.2s, background 0.2s;\n    ",this.notification.append(this.title,this.message,this.button),this.overlay.append(this.notification),document.body.append(this.overlay);const t=document.createElement("style");t.textContent="\n      @keyframes slideIn {\n        from {\n          opacity: 0;\n          transform: translateY(-50px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n    ",document.head.append(t)}show(t,e,i="ÐÐ¾Ð²Ð°Ñ Ð¸Ð³Ñ€Ð°",s=null){this.title.textContent=t,this.message.textContent=e,this.button.textContent=i;const n=this.button.cloneNode(!0);this.button.replaceWith(n),this.button=n,s&&this.button.addEventListener("click",s),this.button.addEventListener("mouseenter",()=>{this.button.style.transform="scale(1.05)"}),this.button.addEventListener("mouseleave",()=>{this.button.style.transform="scale(1)"}),this.overlay.style.display="flex"}hide(){this.overlay.style.display="none"}setButtonText(t){this.button.textContent=t}}class a{constructor(){this.board=new t(4),this.goblin=new e("./assets/images/2dbd01ce16c0fa83cb67.png"),this.scoreManager=new s,this.timer=new i(60),this.cursor=new n,this.notificationManager=new o,this.missedGoblins=0,this.maxMissed=5,this.gameActive=!1,this.currentGoblinTimeout=null,this.isProcessingClick=!1,this.lastClickTime=0,this.clickDebounceDelay=200,this.gameOver=!1,this.startButton=document.getElementById("startBtn"),this.resetButton=document.getElementById("resetBtn"),this.init()}init(){this.board.render(),this.setupEventListeners(),this.updateUI(),this.cursor.attach()}setupEventListeners(){this.startButton.addEventListener("click",()=>{this.gameActive?this.pause():this.start()}),this.resetButton.addEventListener("click",()=>this.reset()),this.board.element.addEventListener("mousedown",t=>{this.handleBoardMouseDown(t)})}handleBoardMouseDown(t){if(!this.gameActive)return;const e=Date.now();if(e-this.lastClickTime<this.clickDebounceDelay)return;this.lastClickTime=e;const i=t.target.closest(".cell");i&&(t.stopPropagation(),this.cursor.hit(),this.handleCellClick(i))}start(){this.gameActive||(this.gameOver&&this.reset(),this.gameActive=!0,this.gameOver=!1,this.startButton.textContent="ÐŸÐ°ÑƒÐ·Ð°",this.startButton.classList.add("btn-secondary"),this.cursor.show(),document.body.classList.add("game-active"),this.timer.start(()=>{this.endGame("Ð’Ñ€ÐµÐ¼Ñ Ð²Ñ‹ÑˆÐ»Ð¾!")}),this.scheduleNextGoblin())}pause(){this.gameActive&&(this.gameActive=!1,this.startButton.textContent="ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ",this.startButton.classList.remove("btn-secondary"),this.timer.pause(),this.clearGoblinTimeout(),this.goblin.hide(),this.cursor.hide(),document.body.classList.remove("game-active"))}reset(){this.gameActive=!1,this.gameOver=!1,this.missedGoblins=0,this.scoreManager.reset(),this.timer.reset(),this.board.resetPositionHistory(),this.goblin.resetPositionHistory(),this.startButton.textContent="ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¸Ð³Ñ€Ñƒ",this.startButton.classList.remove("btn-secondary"),this.clearGoblinTimeout(),this.goblin.hide(),this.cursor.hide(),document.body.classList.remove("game-active"),this.updateUI(),this.notificationManager.hide()}scheduleNextGoblin(){if(!this.gameActive)return;this.clearGoblinTimeout();const t=500+1e3*Math.random();setTimeout(()=>{this.gameActive&&this.showNextGoblin()},t)}showNextGoblin(){if(!this.gameActive)return;const t=this.board.getRandomPosition();this.goblin.show(t),this.currentGoblinTimeout=setTimeout(()=>{this.handleMissedGoblin()},1e3)}handleCellClick(t){const e=parseInt(t.dataset.index);this.goblin.isVisible&&((this.goblin.checkHit?this.goblin.checkHit(e):e===this.goblin.getCurrentPosition())?this.handleGoblinHit():(this.handleMissedGoblin(),t.classList.add("miss"),setTimeout(()=>{t.classList.remove("miss")},300)),setTimeout(()=>{this.cursor.reset()},200))}handleGoblinHit(){this.clearGoblinTimeout(),this.goblin.hit(),this.scoreManager.increase(),setTimeout(()=>{this.goblin.hide(),this.gameActive&&this.scheduleNextGoblin()},200),this.updateUI()}handleMissedGoblin(){if(this.clearGoblinTimeout(),this.goblin.isVisible){if(this.missedGoblins++,this.goblin.hide(),this.missedGoblins>=this.maxMissed)return void this.endGame("ÐŸÑ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾ 5 Ð³Ð¾Ð±Ð»Ð¸Ð½Ð¾Ð²! Ð˜Ð³Ñ€Ð° Ð¾ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð°!");this.updateUI(),this.gameActive&&this.scheduleNextGoblin()}else console.log("Ð“Ð¾Ð±Ð»Ð¸Ð½ ÑƒÐ¶Ðµ Ð½Ðµ Ð²Ð¸Ð´ÐµÐ½, Ð¿Ñ€Ð¾Ð¿ÑƒÑÐº Ð½Ðµ Ð·Ð°ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ")}endGame(t){this.gameActive=!1,this.gameOver=!0,this.clearGoblinTimeout(),this.startButton.textContent="ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¸Ð³Ñ€Ñƒ",this.startButton.classList.remove("btn-secondary"),this.timer.pause(),this.goblin.hide(),this.cursor.hide(),document.body.classList.remove("game-active");const e=this.scoreManager.getScore();this.notificationManager.show("Ð˜Ð³Ñ€Ð° Ð¾ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð°!",`${t}\n\nÐ’Ñ‹ Ð½Ð°Ð±Ñ€Ð°Ð»Ð¸ ${e} Ð¾Ñ‡ÐºÐ¾Ð²!`,"ÐÐ¾Ð²Ð°Ñ Ð¸Ð³Ñ€Ð°",()=>{this.notificationManager.hide(),this.reset()}),this.updateUI()}clearGoblinTimeout(){this.currentGoblinTimeout&&(clearTimeout(this.currentGoblinTimeout),this.currentGoblinTimeout=null)}updateUI(){this.scoreManager.updateDisplay(),this.timer.updateDisplay();const t=document.getElementById("missed");t&&(t.textContent=`${this.missedGoblins}/${this.maxMissed}`,this.missedGoblins>=3&&(t.style.color="#ff9800"),this.missedGoblins>=4&&(t.style.color="#f44336"),this.missedGoblins<3&&(t.style.color="#2196F3")),console.log("Ð¡Ñ‡ÐµÑ‚:",this.scoreManager.getScore(),"ÐŸÑ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾:",this.missedGoblins)}}document.addEventListener("DOMContentLoaded",()=>{new a})})();